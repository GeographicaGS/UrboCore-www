<div class='tags'>
  <%_.each(data, function(dato, index) {

      var mKey = dato.realKey + '_' + index;
      var color;
      if(typeof colors === 'function'){
        color = colors(dato);
      }else{
        color = colors[index];
      }

      var cssClass;
      if(typeof classes === 'function'){
        cssClass = classes(dato);
      }else if(classes && classes.constructor instanceof Array){
        cssClass = classes[index];
      }
    %>

    <div class='btnLegend <%= disabledList[mKey] ? 'inactive': '' %>' id="<%=dato.realKey%>" tag='<%=index%>' style="color:<%= color %>">
      <span class="icon circle <%= cssClass %>" style="background-color:<%= color %>;border: 2px solid <%= color %>"></span>
      <span class="text first"><%= dato.key ? __(dato.key) : '' %></span>

      <%
        var aggInfo = false;
        if(aggregationInfo && aggregationInfo.length) {
          aggInfo = aggregationInfo[index][mKey];
        }else if(aggregationInfo && aggregationInfo[mKey]) {
          aggInfo = aggregationInfo[mKey];
        }

        if(aggInfo){ %>
  			<a class="popup_widget agg multivarChart <%= disabledList[mKey] ? 'hidden': '' %>" href="#">
          <span class="icon"><img class="iconSelected" src="<%=App.getPictureAgg(aggInfo.current)%>"/></span>
  				<div class="varsel">
  						<ul data-id="<%=dato.realKey%>">
  							<%_.each(aggInfo.available,function(v){%>
  								<li data-agg="<%=v%>" class="<%=v == aggInfo.current.toUpperCase() ? 'selected':''%>">
                    <span class="icon">
                      <img class="iconPopup" src="<%=App.getPictureAgg(v)%>"/>
                    </span>
                    <span class="text last"><%=App.getAggStr(v)%></span>
                  </li>
  							<%})%>
  						</ul>
  					</div>
  			</a>
      <% } %>

    </div>
  <% });%>
</div>
